services:
  # Example: httpbin service for testing
  httpbin:
    image: kennethreitz/httpbin
    ports:
      - "8080:80"
    networks:
      - bdg-network

  # bdg service for capturing telemetry
  bdg:
    image: bdg-test:local  # Use local build with latest code
    # Override entrypoint to avoid default daemon startup
    entrypoint: ["/bin/sh", "-c"]
    command:
      - |
        echo "Waiting for httpbin to be ready..."
        sleep 3
        echo "Starting bdg capture..."
        bdg httpbin:80 --headless --port 9224 --timeout 10
        echo "Capture complete, checking output..."
        ls -lh /root/.bdg/ || true
    depends_on:
      - httpbin
    networks:
      - bdg-network
    environment:
      - BDG_DEBUG=0
    # Required for Chrome to run in Docker
    cap_add:
      - SYS_ADMIN
    # Alternative approach (less secure but works in restricted environments):
    # security_opt:
    #   - seccomp=unconfined

networks:
  bdg-network:
    driver: bridge
